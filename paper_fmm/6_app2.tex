\newpage
\section{ddCOSMO discretization\label{app2:mats}}
Here, just for convenience, we repeat some ddCOSMO equations and derivations. This will not be included in the article.

{\bf Definition of operators:}
Single layer potential:
\[
	(\tilde{\mathcal{S}}_j \,  \sigma^j) (x)
	= \int_{\Gamma_j} \frac{\sigma^j(s')}{|s'-x|} \, ds'
	 \quad , \quad x \in \Omega_j
\]
Single layer operator:
\[
	({\mathcal{S}}_j \,  \sigma^j) (s)
	= \int_{\Gamma_j} \frac{\sigma_j(s')}{|s'-s|} \, ds'
	 \quad , \quad s \in \Gamma_j
\]
{\bf ddCOSMO-equations:}
We defined
\begin{equation}
	W_j(x) = (\tilde{\mathcal{S}}^j \,  \sigma^j) (x) \quad , \quad x \in \Omega_j \qquad ; \qquad
	W_j(s) = (\mathcal{S}_j \,  \sigma^j) (s) \quad , \quad s \in \Gamma_j
\end{equation}
and the ddCOSMO-equations become
\begin{equation}
	W_j(s) = - U_j(s) \, \Phi_{\varepsilon,j}(s) +  \big (1 - U_j(s)\big ) \, n_j(s) \, \sum_{k \in N_j} {W}_k(s) \qquad s \in \Gamma_j
\end{equation}
This is equivalent to
\begin{equation}
	\label{eq:B1}
	({\mathcal{S}}_j \,  \sigma^j) (s) = - U_j(s) \, \Phi_{\varepsilon,j}(s) +  \big (1 - U_j(s)\big ) \, n_j(s) \, \sum_{k \in N_j} (\tilde{\mathcal{S}}_k \,  \sigma^k) (s) \qquad s \in \Gamma_j
\end{equation}
{\bf Mapping on unit sphere:}
Then, introducing $ s = x_j +r_j \hat s$ and $ s' = x_j +r_j \hat s'$, we deduce
\[
	({\mathcal{S}}_j \,  \sigma^j) (s)
	= \int_{\Gamma_j} \frac{\sigma^j(s')}{|s'-s|} \, ds'
	= \frac{1}{r_j} \int_{\Gamma_j} \frac{\sigma^j(s')}{\left |\tfrac{s'-x_j}{r_j}-\tfrac{s-x_j}{r_j}\right|} \, ds'
	= r_j \int_{\mathbb S^2} \frac{\sigma^j\left( x_j +r_j \hat s'\right)}{\left |\hat s'-\hat s\right|} \, d\hat s',
\]
so that
\[
	({\mathcal{S}}_j \,  \sigma^j) (x_j +r_j \hat s)
	= 
	r_j ({\mathcal{S}}_{\mathbb S^2} \,  \sigma^j(x_j +r_j \cdot ) ) (\hat s).
\]

In a similar manner, for $x = x_j +r_j \hat x$ (and thus $\hat x\in B_1(0)$):
\[
	(\tilde{\mathcal{S}}_j \,  \sigma^j) (x)
	= \int_{\Gamma_j} \frac{\sigma_j(s')}{|s'-x|} \, ds'
	= r_j\int_{\mathbb S^2} \frac{\sigma^j\left(x_j +r_j  \hat s'\right)}{\left |\hat s'-\hat x\right|} \, d\hat s'
	= r_j (\tilde{\mathcal{S}} \,  \sigma^j(x_j +r_j \cdot )) (\hat x)
	 \quad , \quad x \in \Omega_j.
\]
{\bf Operators applied to spherical harmonics:}
We have
\[
	\left({\mathcal{S}}_j \,  Y_{\ell,m}\left(\tfrac{\cdot - x_j}{r_j}\right)\right) (s)
	= 
	r_j({\mathcal{S}}_{\mathbb S^2} \,  Y_{\ell,m}) (\hat s)
	= 
	\tfrac{4 \pi r_j}{2\ell+1}  Y_{\ell,m} \left(\tfrac{s - x_j}{r_j}\right).
\]
and
\[
	\left(\tilde {\mathcal{S}}_j \,  Y_{\ell,m}\left(\tfrac{\cdot - x_j}{r_j}\right)\right) (x)
	=
	r_j \int_{\mathbb S^2} \frac{Y_{\ell,m}}{\left |\hat s'-\hat x\right|} \, d\hat s'
	=
	\tfrac{4 \pi r_j}{2\ell+1} \, |\hat x|^\ell \, Y_{\ell,m} \left(\tfrac{\hat x}{|\hat x|}\right)
	=
	\tfrac{4 \pi r_j}{2\ell+1} \, \tfrac{|x-x_j|^\ell}{r_j^\ell} \, Y_{\ell,m} \left(\tfrac{x-x_j}{|x-x_j|}\right)
\]
{\bf Approximation:}
We now approximate
\[
	\sigma^j(x_j+r_j \hat s) = \frac{1}{r_j} \sum_{\ell,m} [X_j]_\ell^m Y_{\ell,m} (\hat s).
\]
Observe the scaling by $1/r_j$.
That implies that $W_j$ at any point $x\in\overline{\Omega_j}$ is given by
\[
	W_j(x)
	=
	(\tilde{\mathcal{S}}^j \,  \sigma^j) (x)
	=
	 \frac{1}{r_j} \sum_{\ell,m} [X_j]_\ell^m\left(\tilde{\mathcal{S}}_j \,  Y_{\ell,m}\left(\tfrac{\cdot-x_j}{r_j}\right)\right) (x)
	=
	\sum_{\ell,m} [X_j]_\ell^m\tfrac{4 \pi }{2\ell+1} \, \tfrac{|x-x_j|^\ell}{r_j^\ell} \, Y_{\ell,m} \left(\tfrac{x-x_j}{|x-x_j|}\right)
\] 
We will now multiply \eqref{eq:B1} by $Y_{\ell',m'}$ and integrate over $\Gamma_j$. We start with the left hand side:
\begin{align*}
	\int_{\Gamma_j} ({\mathcal{S}}_j \,  \sigma^j) (s)  \, Y_{\ell',m'}\left(\tfrac{s-x_j}{r_j}\right) \, ds
	&=
	\frac{1}{r_j} \sum_{\ell,m} [X_j]_\ell^m \int_{\Gamma_j} \left({\mathcal{S}}_j \, Y_{\ell,m}\left(\tfrac{\cdot - x_j}{r_j}\right)\right) (s)  \, Y_{\ell',m'}\left(\tfrac{s-x_j}{r_j}\right) \, ds
	\\
	&=  \sum_{\ell,m} \tfrac{4 \pi }{2\ell+1} [X_j]_\ell^m \int_{\Gamma_j} Y_{\ell,m}\left(\tfrac{s - x_j}{r_j}\right)  \, Y_{\ell',m'}\left(\tfrac{s-x_j}{r_j}\right) \, ds
	\\
	&=  \sum_{\ell,m} \tfrac{4 \pi r_j^2}{2\ell+1}  [X_j]_\ell^m \int_{\mathbb S^2} Y_{\ell,m}(\hat s)  \, Y_{\ell',m'} (\hat s) \, d\hat s
	= \tfrac{4 \pi r_j^2}{2\ell'+1}  [X_j]_{\ell'}^{m'}
\end{align*}
The first term of the right hand side becomes
\[
	-\int_{\Gamma_j}  U_j(s) \, \Phi_{\varepsilon,j}(s) Y_{\ell',m'}\left(\tfrac{s-x_j}{r_j}\right) \, ds
	= -r_j^2\int_{\mathbb S^2}  U_j(x_j + r_j\hat s) \, \Phi_{\varepsilon,j}(x_j + r_j\hat s) \, Y_{\ell',m'}\left(\hat s\right) \, d\hat s
\]
The second term on the right hand side can be developed as follows
\begin{align*}
	\lefteqn{\int_{\Gamma_j} \big (1 - U_j(s)\big ) \, n_j(s) \, \sum_{k \in N_j} (\tilde{\mathcal{S}}_k \,  \sigma^k) (s)  \, Y_{\ell',m'}\left(\tfrac{s-x_j}{r_j}\right) \, ds}
	\\
	&= \sum_{k \in N_j}\frac{1}{r_k}\sum_{\ell,m} [X_k]_\ell^m \int_{\Gamma_j} \big (1 - U_j(s)\big ) \, n_j(s) \,   \left(\tilde{\mathcal{S}}_k \,  Y_{\ell,m}\left(\tfrac{\cdot-x_k}{r_k}\right)\right) (s)  \, Y_{\ell',m'}\left(\tfrac{s-x_j}{r_j}\right) \, ds
	\\
	&= \sum_{k \in N_j}\sum_{\ell,m} \tfrac{4 \pi }{2\ell+1}[X_k]_\ell^m \int_{\Gamma_j} \big (1 - U_j(s)\big ) \, n_j(s) \,    \, \tfrac{|s-x_k|^\ell}{r_k^\ell} \, Y_{\ell,m} \left(\tfrac{s-x_k}{|s-x_k|}\right)  \, Y_{\ell',m'}\left(\tfrac{s-x_j}{r_j}\right) \, ds
	\\
	&= r_j^2 \sum_{k \in N_j}\sum_{\ell,m} \tfrac{4 \pi }{2\ell+1}[X_k]_\ell^m \int_{\mathbb S^2} \big (1 - U_j(x_j + r_j\hat s)\big ) \, n_j(x_j + r_j\hat s) \,    \, \tfrac{|x_j + r_j\hat s-x_k|^\ell}{r_k^\ell} \, Y_{\ell,m} \left(\tfrac{x_j + r_j\hat s-x_jk}{|x_j + r_j\hat s-x_k|}\right)  \, Y_{\ell',m'}\left(\hat s\right) \, d\hat s
\end{align*}
Combining all three results yields then the discrete ddCOSMO-equations.
