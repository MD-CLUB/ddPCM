\section{ddCOSMO discretization \label{app:cosmo}}
As customary in a variational setting, we discretize equation \eqref{eq:2} by multiplying it with a test function $\varphi$ and integrating it over $\Gamma_j$. As a preliminary step, we manipulate the following integral as
\[
\int_{\Gamma_j} \tilde{\cS}_{jk} \, \sigma_k \, \varphi =\int_{\Gamma_j} n_j \, \tilde{\cS}_{k} \, \sigma_k \, \varphi = \int_{\Gamma_j} (1 - U_j ) \,n_j \, \tilde{\cS}_{k} \, \sigma_k \, \varphi = \int_{\Gamma_j} V_j \, \tilde{\cS}_{k} \, \sigma_k \, \varphi
\]
We inserted the characteristic function $U_j$ for convenience, and defined the rescaled characteristic function $V_j : \Gamma_j \to \mathbb{R}$ as $V(s) = (1 - U_j(s)) \, n_j(s)$. The reason for introducing the characteristic function is that we can modify it, e.g., replace it by a smooth counterpart, to improve robustness of the algorithm. We obtain the following variational formulation of the integral equation \eqref{eq:2}:
\[
\int_{\Gamma_j} \cS_j \, \sigma_j \, \varphi - \sum_{k \in N_j} \, \int_{\Gamma_j} V_j \, \tilde{\cS}_{k} \, \sigma_k \, \varphi= -\int_{\Gamma_j}  \Phi_{\varepsilon,j} \, \varphi %\qquad , \qquad j = 1, \ldots , M
\]
As a next step, we map quantities to the unit sphere $\mathbb{S}$. In order to do so, we employ the translation-invariant properties $(\cS_j \, \sigma_j)(s) = r_j( \cS \, \hat{\sigma}_j)(z)$ and $(\tilde{\cS}_j \, \sigma_j)(x) = r_j( \tilde{\cS} \, \hat{\sigma}_j)(u)$, where $\cS$ and $\tilde{\cS}$ are, respectively, the single layer operator and potential on the unit sphere, $y = (s - x_j)/r_j$, $u = (x - x_j)/r_j$, and $\hat{\sigma}_j(y) = \sigma_j(s)$. We obtain
\begin{equation}\label{eq:50}
r_j \int_{\mathbb{S}} \cS \, \hat{\sigma}_j \, \hat{\varphi} - \sum_{k \in N_j} \, r_k  \int_{\mathbb{S}} \hat{V}_j \, \tilde{\cS} \, \hat{\sigma}_k \, \hat{\varphi}= -\int_{\mathbb{S}}  \hat{\Phi}_{\varepsilon,j} \, \hat{\varphi}
\end{equation}
where we divided both sides by the surface Jacobian $r_j^2$. The workhorse for the objects $\cS \, \hat{\sigma}_j$ and $\tilde{\cS} \, \hat{\sigma}_k$ is the Addition Theorem for spherical harmonics.

If we expand $\hat{\sigma}_j$ through spherical harmonics $Y_\ell^m$ as
\[
\hat{\sigma}_j(y) = \frac{1}{r_j} \, \sum_{\ell'= 0}^{\infty} \sum_{m' = -\ell'}^{\ell'} \,  [X_j]_{\ell'}^{m'} \, Y_{\ell'}^{m'}(y)
\]
for some (unknown!)~coefficients $X_j = [X_j]_{\ell'}^{m'}$, the orthogonality property of the spherical harmonics implies
\[
(\cS \, \hat{\sigma}_j)(y) = \frac{1}{r_j} \, \sum_{\ell'= 0}^{\infty} \sum_{m' = -\ell'}^{\ell'} \, \frac{4\pi}{(2\ell' + 1)}\, [X_j]_{\ell'}^{m'} \, Y_{\ell'}^{m'}(y)
\]
Thus, if we select as test functions the spherical harmonics, we obtain
\begin{equation*}%\label{eq:51}
r_j\int_\mathbb{S} \cS \, \hat{\sigma}_j \, Y_\ell^m = \sum_{\ell'= 0}^{\infty} \sum_{m' = -\ell'}^{\ell'} \, \frac{4\pi}{(2\ell' + 1)} \, \delta_{\ell \ell'} \delta_{m m'}\, [X_j]_{\ell'}^{m'} 
\end{equation*}
due to their orthogonality. A numerical discretization is obtained by truncating the expansion for some $\ell'=L_\text{max}$. This provides the discrete action $L_{jj} \, X_j$, where the discrete operator
\begin{equation}\label{eq:61}
 [L_{jj}]_{\ell \ell'}^{m m'} =  \frac{4\pi}{(2\ell' + 1)} \, \delta_{\ell \ell'} \delta_{m m'}
\end{equation}
is diagonal and does not depend on the nuclear positions.

Analogously to the previous case, for the off-diagonal term the Addition Theorem implies
\[
(\tilde{\cS} \, \hat{\sigma}_k)(u) = \frac{1}{r_k} \, \sum_{\ell'= 0}^{\infty} \sum_{m' = -\ell'}^{\ell'} \, \frac{4\pi}{(2\ell' + 1)}\, [X_k]_{\ell'}^{m'} \, |u|^{\ell'} \, Y_{\ell'}^{m'}(u/|u|)
\]
We relied on the fact that, when $x \in \Gamma_j$, i.e., $x = s = x_j + r_j y$, then $u = u(y) = (x_j + r_j y -x_k)/r_k$ and $|u| < 1$ because of the assumption $k \in N_j$. We obtain
\begin{multline*}
 r_k \int_\mathbb{S} \hat{V}_j(y) \, (\tilde{\cS} \, \hat{\sigma}_k)(u(y)) \, Y_\ell^m(y) \, dy = \\
=  \sum_{\ell'= 0}^{\infty} \sum_{m' = -\ell'}^{\ell'} \, \frac{4\pi}{(2\ell' + 1)}\, [X_k]_{\ell'}^{m'} \int_\mathbb{S} \hat{V}_j(y) \, |u(y)|^{\ell'} \, Y_{\ell'}^{m'}(u(y)/|u(y)|) \, Y_\ell^m(y) \, dy
\end{multline*}
which, as opposed to the diagonal block $L_{jj}$, requires numerical integration.
%, so that
%\begin{equation}\label{eq:52}
%L_{jk} \, X_k = r_j^2 \, \sum_{\ell'= 0}^{L_\text{max}}  \sum_{m' = -\ell'}^{\ell'} \, \frac{4\pi}{(2\ell' + 1)}\, \sum_{n = 1}^{N_\text{grid}} w_n \, \hat{V}_j(s_n) \, |u(s_n)|^{\ell'} \, Y_{\ell'}^{m'}(u(s_n)/|u(s_n)|) \, Y_\ell^m(s_n)\, [X_k]_{\ell'}^{m'}  
%\end{equation}
This yields the off-diagonal block
\begin{equation}\label{eq:62}
[L_{jk}]_{\ell \ell'}^{m m'} =  \frac{4\pi}{(2\ell' + 1)}\, \sum_{n = 1}^{N_\text{grid}} w_n \, \hat{V}_j(s_n) \, |u(s_n)|^{\ell'} \, Y_{\ell'}^{m'}(u(s_n)/|u(s_n)|) \, Y_\ell^m(s_n)
\end{equation}
where we emploed a Lebedev grid with $N_\text{grid}$ nodes $\{s_n\}$ and weights $\{ w_n \}$ to perform numerical quadrature. We remark that the off-diagonal block $L_{jk}$ depends, \emph{a priori}, upon the nuclear positions $x_j$, $x_k$, and $x_i$, for $i \in N_j$.

The discretization of the right-hand-side of \eqref{eq:50}, i.e., the load vector is simply
\[
[F_j]_\ell^m = - \int_\mathbb{S} \hat{\Phi}_{\varepsilon,j} \, Y_\ell^m
\]
which, in general, does require a numerical quadrature. However, when $\Phi_{\varepsilon,j}$ is provided by the ddPCM step as a truncated series of spherical harmonics with coefficients $-[G_j]_{\ell'}^{m'}$, the orthogonality condition implies
\begin{equation*}
[F_j]_\ell^m = - \int_\mathbb{S} \hat{\Phi}_{\varepsilon,j} \, Y_\ell^m =  \sum_{\ell'= 0}^{L_\text{max}} \sum_{m' = -\ell'}^{\ell'} \, [G_j]_{\ell'}^{m'} \,  \int_{\mathbb{S}}  Y_{\ell'}^{m'} \, Y_\ell^m =  [G_j]_\ell^m
\end{equation*}
so that we conclude that the load vector $F$ coincides with $G$ provided by the ddPCM step.