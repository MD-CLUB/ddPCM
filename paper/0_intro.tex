\section{Introduction}\label{sec:intro}

The effects of solvation play a crucial role in many processes in Chemistry and Biochemistry. While it is unfeasible to always take explicitly into account the individual solvent molecules in a solute/solvent system, in particular when a quantum mechanical description of the molecular system is considered, solvation effects can not be neglected altogether. Thus, a compromise is to resort to a limited description of the solvent, as the solvent {\it per se} is not of interest, but, rather, its effect on the solute molecule is.

Polarizable Continuum Solvation Models (PCSM's)\cite{ReviewPCM_2005,Cramer:1999wt,Orozco_CR_Solvent00,Klamt:2011we,Mennucci:2012ct,honig1995cla,Roux:1999vp,Klamt_JCS_Cosmo,Chipman_JCP_SSVPE,Chipman_JCP_SSVPE2,Mennucci_JCP_IEF1,Mennucci_JMC_IEF2,Mennucci_JPCB_IEF3, Barone_JCPA_CPCM,Cossi_JCC_CPCM, Lipparini_JCP_VPCM,Lipparini_JCTC_VPCMSCF,Truhlar_JPCB_SMD}  focus on the electrostatic interaction between the solute and the solvent by replacing the solvent with an infinite continuum with dielectric permittivity that matches the bulk permittivity of the solvent.
Such approach turns out to be a good compromise between accuracy and the cost to compute electric, magnetic, vibrational and mixed properties\cite{Mennucci_JPCL_PCM,Mennucci:2012ct,ReviewPCM_2005}. As a result, PCSM's are nowadays available in most quantum Chemistry codes, and have become a standard tool among an extended community. 

Standard implementations of PCSM's usually employ the Boundary Element Method\cite{MST,ReviewPCM_1994,ReviewPCM_2005,Scalmani_JCP_CSC,York_JPCA_CSC,
Herbert_JCP_ISWIG} (BEM) to numerically solve a discretized integral equation. This requires the solution of a linear system whose size scales linearly, although with a large proportionality constant, with respect to the number of atoms. This task is usually carried out through standard dense linear algebra techniques, such as the LU decomposition\cite{Cammi_JCC_Inversion}, which require a computational effort of cubic complexity, with respect to the size of the system. Consequently, the solution step can rapidly become demanding when dealing with systems as large as those treated via QM/MM methods, and one should seek other strategies. An alternative is provided by iterative techniques, which reduce the computational cost to that of several matrix-vector multiplications\cite{Scalmani_TCA_Iterative}, which is, in  the general case, quadratic. When fast summation techniques, e.g., the Fast Multipole Method (FMM)\cite{FMM}, can be employed, the computational complexity can be further reduced. Thus, it is possible to solve the PCSM linear equations in a number of floating point operations which is linear with respect to the number of atoms. Nevertheless, the solution of the PCSM equations can still represent a formidable bottleneck for large systems\cite{Lipparini_JPCL_ddCOSMO}, especially when repeated computations are required for statistical sampling purposes or time-dependent simulations.

In recent years, we have proposed an alternative approach for PCSM's which is based on  domain-decomposition. We introduced a novel strategy\cite{Cances_JCP_ddCOSMO}, referred to as ddCOSMO\cite{Cances_JCP_ddCOSMO,Lipparini_JCTC_ddCOSMO,Lipparini_JPCL_ddCOSMO,Lipparini_JCP_ddCOSMO-QM}, to solve the PCSM equation for the Conductor-like Screening Model\cite{Klamt_JCS_Cosmo} (COSMO) in combination with Van der Waals molecular cavities. 
As a first step, the COSMO equation in its differential form is rewritten as a system of coupled linear differential equations on each sphere, where the coupling occurs only between overlapping spheres. Secondly, each differential equation is recast as an integral equation, so that it can be efficiently solved by using a (truncated) expansion of spherical harmonics\cite{Cances_JCP_ddCOSMO}. The discretization produces a block-sparse linear system\cite{Lipparini_JCTC_ddCOSMO}, where only the blocks corresponding to overlapping spheres are nonzero. This structure allows for a computational cost that scales linearly with respect to the number of atoms, and is overall very small as compared to competing techniques. Indeed, as shown in \cite{Lipparini_JPCL_ddCOSMO}, as many as two or three orders of magnitude are gained by the ddCOSMO approach.

More recently, the method has been generalized to the Polarized Continuum Model (PCM) equation, which assumes a finite permittivity of the solvent. This resulted in the ddPCM method\cite{Stamm_JCP_DDPCM}, which is based on the same domain-decomposition approach. 
While the method has been developed in \cite{Stamm_JCP_DDPCM} to compute the electrostatic contribution to the solvation energy, the aim of this article is to present the derivation of analytical forces of the ddPCM solvation energy.

%Polarizable continuum solvation models (PCSM) represent a powerful tool in computational chemistry\cite{ReviewPCM_2005,Cramer:1999wt,Orozco_CR_Solvent00,Klamt:2011we,Mennucci:2012ct,honig1995cla,Roux:1999vp,Klamt_JCS_Cosmo,Chipman_JCP_SSVPE,Chipman_JCP_SSVPE2,Mennucci_JCP_IEF1,Mennucci_JMC_IEF2,Mennucci_JPCB_IEF3, Barone_JCPA_CPCM,Cossi_JCC_CPCM, Lipparini_JCP_VPCM,Lipparini_JCTC_VPCMSCF,Truhlar_JPCB_SMD}. Such models allow one to include environmental effects in the modeling of a molecular property in a cost-effective and almost black-box way and their extensions and developments include the coupling with the vast majority of the levels of theory used in quantum mechanical (QM) based computations and the development of analytical derivatives techniques to compute electric, magnetic, vibrational and mixed properties\cite{Mennucci_JPCL_PCM,Mennucci:2012ct,ReviewPCM_2005}. As a result, PCSM are nowadays available in most quantum chemistry codes and have become a standard tool, which can be successfully used by an extended community. 
%
%One of the key features of PCSM is their cost-effectiveness, which is however based on the assumption that a QM method can only be used to treat small to medium size systems and that the computational cost associated with the solution of the QM equations is much higher than the one due to PCSM themselves\cite{Scalmani_TCA_Iterative,Cammi_JCC_Inversion,Lipparini_JCP_VPCM,Lipparini_JPCL_ddCOSMO}. 
%In the last decade, the diffusion and refinement of linear scaling techniques and of hybrid QM/Classical strategies, mainly QM/MM methods, have seriously undermined such an assumption, as systems of several hundreds atoms can be nowadays routinely described with QM methods such as density functional theory and systems of several thousands of atoms can be modeled with QM/MM methods\cite{Warshel_JMB_QMMM,Warshel_JACS_QMMM,Gao_Science_QMMM,Bakowies_JPC_QMMM,Truhlar_TCA_QMMMReview,Thiel_ACIE_QMMMReview,
%Barone_Libro_QMMM}.
%In standard implementations, which are usually based on the Boundary Element Method\cite{MST,ReviewPCM_1994,ReviewPCM_2005,Scalmani_JCP_CSC,York_JPCA_CSC,
%Herbert_JCP_ISWIG} (BEM), PCSM require one to numerically solve a discretized integral equation, which in practical terms requires the solution of a linear system the size of which scales linearly, but with a large constant (a rough estimate would be 50--100), with respect to the number of atoms.  This is usually done using dense linear algebra techniques, such as LU decomposition\cite{Cammi_JCC_Inversion}, which require a computational effort proportional to the cube of the size of the linear system: such an operation can therefore rapidly become demanding when dealing with systems as large as the ones treated via QM/MM methods: other strategies become mandatory. Iterative techniques can be used to reduce the computational cost to the cost of several matrix-vector multiplications\cite{Scalmani_TCA_Iterative}, avoiding thus cubic operations; fast summation techniques, typically, the Fast Multipole Method (FMM)\cite{FMM}, can then be used to further reduce the cost of solving the PCSM linear equations to a number of floating point operations which is linear in the number of atoms. Nevertheless, the solution of the PCSM equations can still represent a formidable bottleneck for large systems\cite{Lipparini_JPCL_ddCOSMO}, especially, when repeated computations are required for statistical sampling purposes or time-dependent simulations.
%
%In a recent publication\cite{Cances_JCP_ddCOSMO}, we have introduced a completely different strategy to solve the PCSM equation for the Conductor-like Screening Model\cite{Klamt_JCS_Cosmo} (COSMO) in combination with Van der Waals molecular cavities. Such a strategy is based on a domain-decomposition approach\cite{DD_Method} and we refer to it as ddCOSMO\cite{Cances_JCP_ddCOSMO,Lipparini_JCTC_ddCOSMO,Lipparini_JPCL_ddCOSMO,Lipparini_JCP_ddCOSMO-QM}: the COSMO equation, in its differential form, is rewritten as a system of coupled linear differential equations, one per sphere, where only overlapping spheres are actually coupled. The differential equations on each sphere can then be recast as integral equations and solved very efficiently by using a (truncated) expansion in spherical harmonics\cite{Cances_JCP_ddCOSMO}. The discretization produces a block-sparse linear system\cite{Lipparini_JCTC_ddCOSMO}, where only the blocks corresponding to overlapping spheres are non-zero: this structure allows for a computational cost that scales linearly with respect to the number of atoms and is overall very small as compared to previous implementations: as far as two or three orders of magnitude are gained, as shown in a recent publication\cite{Lipparini_JPCL_ddCOSMO}.
%
%The aim of this article is to extend the ddCOSMO paradigm to the more general Polarizable Continuum Model\cite{ReviewPCM_2005} (PCM), and in particular to its most general formulation, IEF-PCM\cite{Mennucci_JCP_IEF1,Mennucci_JPCB_IEF3}, which treats the environment as a dielectric, and not as a perfect conductor: this is desirable not only for the sake of generality, but also because for low-polar solvents, the COSMO description is not physically appropriate. Unfortunately, from a mathematical point of view, PCM is much more complex than COSMO\cite{Cances_Librone_PCM} and a straightforward extension of the domain decomposition strategy we applied to the COSMO problem is not possible. In this paper, we propose an iterative algorithm to solve the PCM equation, called ddPCM, by decomposing the PCM problem in two steps, the second of which is a ddCOSMO computation. Our procedure is consistent with ddCOSMO in the sense that, for large enough dielectric constants, it gives the same results for the same discretization parameters; furthermore, it shares ddCOSMO's good properties of being systematically improvable and only controlled by a very limited amount of parameters. From a computational point of view, ddPCM remains substantially more expensive than ddCOSMO and, at the moment, requires a computation whose cost scales quadratically with the size of the system. Nevertheless, fast summation techniques can be used to overcome this quadratic bottleneck\cite{FMM} their application to ddPCM will be object of a forthcoming communication.

This paper is organized as follows. Section \ref{sec:review} reviews the ddPCM and ddCOSMO methods that we have previously developed. In Section \ref{sec:forces} we describe the derivation of the ddPCM forces and discuss their efficient implementation. Section \ref{sec:experiments} is devoted to numerical experiments. Finally, in Section \ref{sec:conclusions} we draw conclusions from the presented work and point to possible future directions of research.