\section{Introduction}\label{sec:intro}
Solvation plays a crucial role in many processes in Chemistry and Biochemistry. As a consequence, including the effects of the solvent in the description of a chemical system is of paramount importance in computational chemistry. This can be in principle achieved by including enough solvent molecule in the computational representation of the system. Unfortunately, solute-solvent interactions are often dominated by long-range electrostatic contributions, which would require the inclusion of an extended number of solvent molecules to be properly described. When an accurate, quantum mechanical level of theory is employed, the presence of a large number of solvent molecule can easily make the computation very expensive or even completely unfeasible. Furthermore, the system would not be correctly represented by a single configuration, requiring thus one to repeat the computation many times in order to take care of statistical sampling. 

Such a brute force strategy is not only undesirable, but also not always necessary when one aims at describing the solute's and its properties in the presence of a solvent, but not the solvent itself. In such a case, a \textit{focused model} can be used, where the solute is described accurately, while the solvent is treated with an approximated level of theory which is, however, sufficient to introduce the desired solute-solvent interactions. 
A popular choice to describe solvation is to use QM/MM models\cite{Warshel_JMB_QMMM,Warshel_JACS_QMMM,Gao_Science_QMMM,Bakowies_JPC_QMMM,Truhlar_TCA_QMMMReview,Thiel_ACIE_QMMMReview,
Barone_Libro_QMMM,Morokuma_CR_ONIOM,Cappelli_IJQC_FQRev}, where the solute is treated at a quantum mechanical level of theory, while the solvent is described with a force field and solute-solvent interactions are introduced via electrostatic interactions, possibly including mutual polarization\cite{Curutchet_JCTC_MMPol,Kongsted_JCTC_MMPExc,Christiansen_JCTC_MMPExcCCDFT,Steindal_PCCP_MMPExc,Caprasecca_JCTC_FMM,Lipparini_JCP_FQMag,Lipparini_JCTC_FQTD,Boulanger_JCTC_Drude,Boulanger_JCTC_QMMMPolPCM,Loco_JCTC_QMAMOEBA}. QM/MM methods, however, still require to take care of the statistical sampling, which, for some properties, can be particularly challenging\cite{Lipparini_JCTC_ORMoxy,Giovannini_JCTC_FQVCD,Giovannini_JCTC_FQROA}.

Polarizable continuum solvation models\cite{MST,ReviewPCM_1994,ReviewPCM_2005,Orozco_CR_Solvent00,Klamt:2011we,Mennucci:2012ct,honig1995cla,Roux:1999vp} (PCSM) replace the solvent with a uniform, infinite polarizable continuum, which interacts with the solute's density of charge in a mutually polarizable fashion. PCSM do not require statistical sampling, as such an effect is implicitly included in the use of a macroscopic property, namely, the bulk dielectric permittivity $\varepsilon_s$, to model the solvent response. The interaction between the solute and the solvent is modeled via electrostatics. For a given value of the solute's density of charge, the electrostatics equations are solved in the presence of the polarizable continuum and a \emph{reaction potential} is then added to the solute's Hamiltonian. A new density of charge is then computed and the process is iterated until mutual polarization has been achieved\cite{ReviewPCM_2005,Lipparini_JCP_VPCM,Lipparini_JCTC_VPCMSCF,Lipparini_JCP_Perspective}.
PCSM have been extended in the last decades to introduce solvent effects on molecular structures and properties\cite{Tomasi_PCCP_PCMProps,Mennucci_Chir_PCMProps,Mennucci_JPCL_PCM} and are nowadays available in most quantum chemistry codes, and have become a standard tool among computational chemists. 

More recently, PCSM and QM/MM methods have been combined\cite{Pedone_CPC_QMMMPCM,Rega_JACS_QMMMPCM,Vreven_JCP_OniomPCM,Bandyopadhyay2002,Lipparini_JCTC_FQPCM,Caprasecca_JCTC_FMM,Steindal_JCPA_QMMMPCM,Boulanger_JCTC_QMMMPolPCM,Caprasecca_JCTC_QMMMPolPCM} in order to retain the atomistic description provided by QM/MM models, which is needed in order to describe specific solute-solvent interactions, and the inexpensive handling of long-range electrostatic interactions of PCSM.

Standard implementations of PCSM's usually employ the Boundary Element Method\cite{MST,ReviewPCM_1994,ReviewPCM_2005,Scalmani_JCP_CSC,York_JPCA_CSC,
Herbert_JCP_ISWIG} (BEM) to numerically solve a discretized integral equation. This requires the solution of a linear system whose size scales linearly, although with a large proportionality constant, with respect to the number of atoms. This task is usually carried out through standard dense linear algebra techniques, such as the LU decomposition\cite{Cammi_JCC_Inversion}, which require a computational effort of cubic complexity, with respect to the size of the system. Consequently, the solution step can rapidly become demanding when dealing with systems as large as those treated via QM/MM methods, and one should seek other strategies. An alternative is provided by iterative techniques, which reduce the computational cost to that of several matrix-vector multiplications\cite{Scalmani_TCA_Iterative}, which is, in  the general case, quadratic. When fast summation techniques, e.g., the Fast Multipole Method (FMM)\cite{FMM}, can be employed, the computational complexity can be further reduced. Thus, it is possible to solve the PCSM linear equations in a number of floating point operations which is linear with respect to the number of atoms. Nevertheless, the solution of the PCSM equations can still represent a formidable bottleneck for large systems\cite{Lipparini_JPCL_ddCOSMO}, especially when repeated computations are required for statistical sampling purposes or time-dependent simulations.

In recent years, we have proposed an alternative approach for PCSM's which is based on  domain-decomposition. We introduced a novel strategy\cite{Cances_JCP_ddCOSMO}, referred to as ddCOSMO\cite{Cances_JCP_ddCOSMO,Lipparini_JCTC_ddCOSMO,Lipparini_JPCL_ddCOSMO,Lipparini_JCP_ddCOSMO-QM}, to solve the PCSM equation for the Conductor-like Screening Model\cite{Klamt_JCS_Cosmo} (COSMO) in combination with Van der Waals molecular cavities. 
As a first step, the COSMO equation in its differential form is rewritten as a system of coupled linear differential equations on each sphere, where the coupling occurs only between overlapping spheres. Secondly, each differential equation is recast as an integral equation, so that it can be efficiently solved by using a (truncated) expansion of spherical harmonics\cite{Cances_JCP_ddCOSMO}. The discretization produces a block-sparse linear system\cite{Lipparini_JCTC_ddCOSMO}, where only the blocks corresponding to overlapping spheres are nonzero. This structure allows for a computational cost that scales linearly with respect to the number of atoms, and is overall very small as compared to competing techniques. Indeed, as shown in \cite{Lipparini_JPCL_ddCOSMO}, as many as two or three orders of magnitude are gained by the ddCOSMO approach.

More recently, the method has been generalized to the Integral Equation Formalism Polarizable Continuum Model (IEFPCM) equation\cite{Mennucci_JCP_IEF1,Mennucci_JMC_IEF2,Mennucci_JPCB_IEF3}, which assumes a finite permittivity of the solvent. This resulted in the ddPCM method\cite{Stamm_JCP_DDPCM}, which is based on the same domain-decomposition approach. 
While the method has been developed in \cite{Stamm_JCP_DDPCM} to compute the electrostatic contribution to the solvation energy, the aim of this article is to present the derivation of analytical forces of the ddPCM solvation energy.

This paper is organized as follows. Section \ref{sec:review} reviews the ddPCM and ddCOSMO methods that we have previously developed. In Section \ref{sec:forces} we describe the derivation of the ddPCM forces and discuss their efficient implementation. Section \ref{sec:experiments} is devoted to numerical experiments. Finally, in Section \ref{sec:conclusions} we draw conclusions from the presented work and point to possible future directions of research.